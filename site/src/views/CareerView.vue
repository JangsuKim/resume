<template>
  <div class="min-h-screen bg-gray-100 py-10 px-4">
    <!-- ìŠ¤ì¼€ì¼ëŸ¬ ë˜í¼ -->
    <div
      class="mx-auto select-none"
      :style="{ width: (BASE_WIDTH * effectiveScale) + 'px' }"
      style="touch-action: pan-y; -ms-touch-action: pan-y;"
      @dblclick.prevent="toggleMode"
      @touchstart="onTouchStart"
      @touchmove.prevent="onTouchMove"
      @touchend.passive="onTouchEnd"
    >
      <!-- A4 ì¹´ë“œ -->
      <div
        class="relative bg-white border border-gray-300 shadow-sm rounded-md p-10 pt-16"
        style="width: 820px;"
        :style="{ transform: `scale(${effectiveScale})`, transformOrigin: 'top left' }"
      >
        <!-- ì¢Œì¸¡ ìƒë‹¨ ëŒì•„ê°€ê¸° -->
        <RouterLink
          to="/"
          class="absolute left-6 top-6 flex items-center gap-1 text-blue-600 hover:text-gray-900 transition-colors"
        >
          <span class="text-lg">â†</span>
          <span class="text-sm font-medium">å±¥æ­´æ›¸ã«æˆ»ã‚‹</span>
        </RouterLink>

        <!-- íƒ€ì´í‹€ -->
        <header class="text-center">
          <h1 class="text-3xl font-extrabold tracking-wider">è·å‹™çµŒæ­´æ›¸</h1>
          <div class="mt-3 h-px bg-neutral-300"></div>
        </header>

        <!-- ë©”íƒ€(ìµœì¢… ì—…ë°ì´íŠ¸, ë§í¬ ì•µì»¤) -->
        <div class="mt-3 flex items-center justify-between text-xs text-gray-500">
          <span>æœ€çµ‚æ›´æ–°ï¼š2025-10-14</span>
          <nav class="space-x-4">
            <a href="#intro" class="hover:underline">è‡ªå·±ç´¹ä»‹</a>
            <a href="#projects" class="hover:underline">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</a>
            <a href="#skills" class="hover:underline">ã‚¹ã‚­ãƒ«</a>
          </nav>
        </div>

        <!-- è‡ªå·±ç´¹ä»‹ -->
        <section id="intro" class="mt-8">
          <h2 class="text-lg font-semibold tracking-wide">è‡ªå·±ç´¹ä»‹</h2>
          <div class="mt-3 text-sm leading-7 text-gray-700">
            <!-- è¦ç´„ -->
            <p>
              å¤§é˜ªåœ¨ä½ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ã‚­ãƒ ãƒ»ã‚¸ãƒ£ãƒ³ã‚¹ã§ã™ã€‚
              2017å¹´ã«æ¥æ—¥ã—ã¦ã‹ã‚‰ç´„8å¹´é–“ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã«æºã‚ã£ã¦ãã¾ã—ãŸã€‚
              Java ã¨ PHPï¼ˆLaravelï¼‰ã‚’ä¸­å¿ƒã«ã€è¦ä»¶å®šç¾©ã‹ã‚‰è¨­è¨ˆã€å®Ÿè£…ã€ãƒ†ã‚¹ãƒˆã€é‹ç”¨ã¾ã§ä¸€è²«ã—ã¦å¯¾å¿œã—ã¾ã™ã€‚
              SIerã§ã®5å¹´ã«åŠ ãˆã€ç›´è¿‘ã¯è‡ªç¤¾é–‹ç™ºã§ã®3å¹´ã‚’é€šã˜ã¦ã€å …ç‰¢ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã®é«˜ã„ã‚·ã‚¹ãƒ†ãƒ ã¥ãã‚Šã¨
              ãƒãƒ¼ãƒ é–‹ç™ºã®æ¨é€²ã«æ³¨åŠ›ã—ã¦ã„ã¾ã™ã€‚
            </p>

            <!-- å±•é–‹ã‚¨ãƒªã‚¢ -->
            <transition name="fade">
              <div v-if="showFullIntro" class="mt-3 space-y-3">
                <p>
                  å¤§å­¦ã§ã¯è¦³å…‰å­¦ã‚’å°‚æ”»ã—ã€æ—¥æœ¬èªã‚’å­¦ã³ã¾ã—ãŸã€‚å¯Œå£«ãƒ•ã‚¤ãƒ«ãƒ ã®ç·å‹™éƒ¨ã§ã®çµŒé¨“ã‚’çµŒã¦ã€
                  å°†æ¥ã‚’è¦‹æ®ãˆã¦ IT ã«è»¢å‘ã€‚2016å¹´ã«å­¦ç¿’ã‚’é–‹å§‹ã—ã€ç¿Œå¹´ã‹ã‚‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã¨ã—ã¦ã®ã‚­ãƒ£ãƒªã‚¢ã‚’æ­©ã‚“ã§ã„ã¾ã™ã€‚
                  ç¾åœ¨ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’ä¸»è»¸ã«ã—ã¤ã¤ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¨é€²ã«ã‚‚ç©æ¥µçš„ã«é–¢ã‚ã‚Šã¾ã™ã€‚
                </p>

                <ul class="list-disc pl-5 space-y-1">
                  <li><span class="font-medium">æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯</span>ï¼šJavaã€PHPã€TypeScriptã€Spring Bootã€Laravelã€Vueã€MySQLã€Redisã€AWSã€Dockerã€Linux</li>
                  <li><span class="font-medium">å¼·ã¿</span>ï¼šè¦ä»¶ã®æŠ½è±¡åŒ–ã‹ã‚‰å®Ÿè£…ãƒ»æ¤œè¨¼ã¾ã§ã‚’ç€å®Ÿã«æ¨é€²ã—ã€å“è³ªã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ã“ã¨</li>
                  <li><span class="font-medium">ä¾¡å€¤è¦³</span>ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã¨é–‹ç™ºç”Ÿç”£æ€§ã®ä¸¡ç«‹ã€ãƒãƒ¼ãƒ ã§å†ç¾å¯èƒ½ãªä»•çµ„ã¿åŒ–</li>
                </ul>

                <p>
                  ç›´è¿‘ã¯ã‚µã‚¹ãƒ†ãƒŠãƒ“ãƒªãƒ†ã‚£é ˜åŸŸã®å•†ç”¨ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚³ã‚¢æ©Ÿèƒ½ã®è¨­è¨ˆãƒ»å®Ÿè£…ã‚’æ‹…å½“ã€‚
                  ä»¥å‰ã¯å¤§è¦æ¨¡ EC ã§ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆé ˜åŸŸã®æ–°æ©Ÿèƒ½é–‹ç™ºã‚„ä¸æ­£å¯¾ç­–ã‚’çµŒé¨“ã—ã€
                  é«˜ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ç’°å¢ƒã§ã®æ€§èƒ½ãƒ»å®‰å®šæ€§å‘ä¸Šã«å–ã‚Šçµ„ã¿ã¾ã—ãŸã€‚
                </p>

                <div class="pt-1 text-xs text-gray-600">
                  ğŸ”— GitHubï¼š
                  <a href="https://github.com/JangsuKim" target="_blank" rel="noopener" class="underline">
                    github.com/JangsuKim
                  </a>
                </div>
              </div>
            </transition>

            <!-- ãƒˆã‚°ãƒ« -->
            <button
              type="button"
              class="mt-3 text-xs inline-flex items-center gap-1 px-2 py-1 rounded border 
                    text-gray-600 border-gray-300 bg-gray-100 hover:bg-gray-200 active:scale-[0.99]"
              @click="showFullIntro = !showFullIntro"
            >
              <span v-if="!showFullIntro">è©³ç´°ã‚’è¡¨ç¤º</span>
              <span v-else>è©³ç´°ã‚’é–‰ã˜ã‚‹</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" viewBox="0 0 20 20" fill="currentColor">
                  <!-- ë‹«í˜ ìƒíƒœì—ì„œëŠ” ìœ„ìª½(â–²) -->
                  <path v-if="!showFullIntro" fill-rule="evenodd"
                    d="M10 17a1 1 0 01-.832-.445l-5-7A1 1 0 115.832 8.445L10 14.118l4.168-5.673a1 1 0 111.664 1.11l-5 7A1 1 0 0110 17z"
                    clip-rule="evenodd" />
                  <!-- ì—´ë¦¼ ìƒíƒœì—ì„œëŠ” ì•„ë˜ìª½(â–¼) -->
                  <path v-else fill-rule="evenodd"
                    d="M10 3a1 1 0 01.832.445l5 7a1 1 0 01-1.664 1.11L10 5.882 5.832 11.555A1 1 0 114.168 10.445l5-7A1 1 0 0110 3z"
                    clip-rule="evenodd" />
                </svg>
            </button>
          </div>
        </section>


        <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ -->
        <section id="projects" class="mt-10">
          <h2 class="text-lg font-semibold tracking-wide">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</h2>
          <p class="mt-2 text-sm text-gray-600">â€» ä¼šç¤¾ â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®2æ®µã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã§ã™ã€‚</p>

          <div class="mt-4">
            <CompanyAccordion :companies="careerCompanies" :print-mode="printMode" />
          </div>
        </section>

        <!-- ìŠ¤í‚¬(ìë¦¬ë§Œ) -->
        <section id="skills" class="mt-10">
          <h2 class="text-lg font-semibold tracking-wide">ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ã‚¹ã‚­ãƒ«</h2>
          <div class="mt-3 pl-2">
            <TechStackCompact :groups="techGroups" />
          </div>
        </section>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onBeforeUnmount } from 'vue'
import CompanyAccordion from '@/components/career/CompanyAccordion.vue'
import TechStackCompact from '@/components/TechStackCompact.vue'
import { careerCompanies } from '@/data/career'

// ğŸ›  CareerView.vue (ìƒë‹¨ <script setup> ë‚´ë¶€)
type Size = 'xl' | 'lg' | 'md' | 'sm'
type TechItem = { name: string; icon: string; size?: Size; note?: string }
type TechGroup = { title: string; items: TechItem[]; defaultSize?: Size }

// âœ… techGroups ì •ì˜ë¥¼ ì•„ë˜ì²˜ëŸ¼ ìˆ˜ì • (point: satisfies)
const techGroups = [
  {
    title: 'Backend',
    items: [
      { name: 'Java',   icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/java/java-original.svg', size: 'xl', note: '5å¹´ä»¥ä¸Š' },
      { name: 'Spring', icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/spring/spring-original.svg', size: 'xl', note: '5å¹´ä»¥ä¸Š' },
      { name: 'PHP',    icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/php/php-original.svg', size: 'md', note: '1å¹´ä»¥ä¸Š' },
      { name: 'Laravel',icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/laravel/laravel-original.svg', size: 'md', note: '1å¹´ä»¥ä¸Š' },
    ],
  },
  {
    title: 'Frontend',
    items: [
      { name: 'JavaScript', icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/javascript/javascript-original.svg', size: 'lg', note: '3å¹´ä»¥ä¸Š' },
      { name: 'jQuery',     icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/jquery/jquery-original.svg',         size: 'lg', note: '3å¹´ä»¥ä¸Š' },
      { name: 'Vue 3',      icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/vuejs/vuejs-original.svg',           size: 'md', note: '1å¹´ä»¥ä¸Š' },
      { name: 'HTML5',      icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/html5/html5-original.svg',           size: 'md', note: '1å¹´ä»¥ä¸Š' },
      { name: 'CSS3',       icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/css3/css3-original.svg',             size: 'md', note: '1å¹´ä»¥ä¸Š' },
    ],
  },
  {
    title: 'Database',
    items: [
      { name: 'MySQL',      icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/mysql/mysql-original.svg',           size: 'lg', note: '3å¹´ä»¥ä¸Š' },
      { name: 'Oracle',     icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/oracle/oracle-original.svg',         size: 'lg', note: '1å¹´ç¨‹åº¦' },
      { name: 'PostgreSQL', icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/postgresql/postgresql-original.svg', size: 'md', note: '1å¹´ç¨‹åº¦' },
      { name: 'Redis',      icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/redis/redis-original.svg',           size: 'md', note: 'åŠå¹´ç¨‹åº¦' },
    ],
  },
  {
    title: 'Tools / Cloud',
    defaultSize: 'sm',
    items: [
      { name: 'Git',    icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/git/git-original.svg', note: '4å¹´ä»¥ä¸Š'  },
      { name: 'GitHub', icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/github/github-original.svg', note: '4å¹´ä»¥ä¸Š'  },
      { name: 'Docker', icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/docker/docker-original.svg', note: '5å¹´ä»¥ä¸Š'  },
      { name: 'Linux',  icon: 'https://cdn.jsdelivr.net/gh/devicons/devicon@latest/icons/linux/linux-original.svg', note: '7å¹´ä»¥ä¸Š'  },
      { name: 'AWS', icon: 'https://a0.awsstatic.com/libra-css/images/logos/aws_logo_smile_1200x630.png', note: '2å¹´ä»¥ä¸Š'  },
    ],
  },
] satisfies TechGroup[]


const BASE_WIDTH = 820
const OUTER_PADDING = 32

type Mode = 'fit' | 'actual'
const mode = ref<Mode>('fit')

const fitScale = ref(1)
const scale = ref(1)
const showFullIntro = ref(false)

// ğŸ”¹ ì¸ì‡„ ëª¨ë“œ í”Œë˜ê·¸ (before/after printì—ì„œ ì œì–´)
const printMode = ref(false)

// ë‚´ë¶€ ì¤Œ ë²”ìœ„
const MIN_SCALE = 0.5
const MAX_SCALE = 1.4

const effectiveScale = computed(() => (mode.value === 'fit' ? fitScale.value : scale.value))

function computeFit() {
  const vw = window.innerWidth
  const available = Math.max(0, vw - OUTER_PADDING)
  fitScale.value = Math.min(1, available / BASE_WIDTH)
}

function toggleMode() {
  if (mode.value === 'fit') {
    mode.value = 'actual'
    scale.value = clamp(fitScale.value, MIN_SCALE, 1)
  } else {
    mode.value = 'fit'
  }
}

const clamp = (v: number, min: number, max: number) => Math.max(min, Math.min(max, v))

/* ----- í•€ì¹˜ì¤Œ ----- */
let pinchStartDist = 0
let pinchStartScale = 1
const getDist = (t0: Touch, t1: Touch) => Math.hypot(t0.clientX - t1.clientX, t0.clientY - t1.clientY)

function onTouchStart(e: TouchEvent) {
  if (e.touches.length === 2) {

    e.preventDefault()
    if (e.touches[0] && e.touches[1]) pinchStartDist = getDist(e.touches[0], e.touches[1])
    if (mode.value === 'fit') {
      mode.value = 'actual'
      scale.value = clamp(fitScale.value, MIN_SCALE, 1)
    }
    pinchStartScale = scale.value
  }
}

function onTouchMove(e: TouchEvent) {
  if (e.touches.length === 2 && pinchStartDist > 0) {
    e.preventDefault()
    if (e.touches[0] && e.touches[1]) {
      const dist = getDist(e.touches[0], e.touches[1])
      const factor = dist / pinchStartDist

      const target = pinchStartScale * Math.pow(factor, 0.85)
      scale.value = clamp(+target.toFixed(3), MIN_SCALE, MAX_SCALE)
    }
  }
}


let lastTouch = 0
function onTouchEnd(e: TouchEvent) {
  if (e.touches.length < 2) pinchStartDist = 0
  const now = Date.now()
  if (now - lastTouch < 300) {

    if (e.changedTouches && e.changedTouches.length === 1) {
      toggleMode()
      e.preventDefault()
    }
  }
  lastTouch = now
}
/* ------------------ */

// ğŸ”¹ ì¸ì‡„ í›…: beforeprintì— ëª¨ë‘ í¼ì¹˜ê¸°
function handleBeforePrint() {
  printMode.value = true        // íšŒì‚¬Â·í”„ë¡œì íŠ¸ ì•„ì½”ë””ì–¸ ì „ë¶€ í¼ì¹¨
  showFullIntro.value = true    // ìê¸°ì†Œê°œ ìƒì„¸ í¼ì¹¨
}
function handleAfterPrint() {
  printMode.value = false
}

onMounted(() => {
  computeFit()
  window.addEventListener('resize', computeFit, { passive: true })

  // ğŸ”¹ ê²½ë ¥ í˜ì´ì§€ ì§„ì… ì‹œ ìµœìƒë‹¨ìœ¼ë¡œ
  window.scrollTo({ top: 0, left: 0, behavior: 'auto' })

  // ğŸ”¹ í”„ë¦°íŠ¸ í›… ë“±ë¡
  window.addEventListener('beforeprint', handleBeforePrint)
  window.addEventListener('afterprint', handleAfterPrint)
})
onBeforeUnmount(() => {
  window.removeEventListener('resize', computeFit)
  window.removeEventListener('beforeprint', handleBeforePrint)
  window.removeEventListener('afterprint', handleAfterPrint)
})
</script>

<style scoped>
.fade-enter-active, .fade-leave-active { transition: opacity .15s ease; }
.fade-enter-from, .fade-leave-to { opacity: 0; }

/* ğŸ”¹ ì¸ì‡„ ìµœì í™” */
@media print {
  /* ëª¨ë“  ê·¸ë¦¼ì ì œê±° */
  .shadow-sm, .shadow,
  :deep(.shadow-sm), :deep(.shadow) {
    box-shadow: none !important;
  }

  /* ì ì„  í…Œë‘ë¦¬ â†’ ì‹¤ì„ ìœ¼ë¡œ ë³€ê²½ */
  .border-dashed,
  :deep(.border-dashed) {
    border-style: solid !important;
  }

}
</style>
